#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
修复 step7_4_multi_system_heat_capacity.py 文件的中文乱码问题
"""

import re
import os
import shutil
from pathlib import Path

# 常见乱码到正确中文的映射表
MOJIBAKE_MAP = {
    # 标题和常用词
    '澶氫綋绯?': '多体系',
    '鍗曟杩愯': '单次运行',
    '鐑瀹?': '热容',
    '列嗘瀽': '分析',
    '浣滆€?': '作者',
    '鏃ユ湡': '日期',
    '鐗堟湰': '版本',
    '鏈€杩戞洿鏂?': '最近更新',
    
    # 常用词汇
    '淇': '修复',
    '闂': '问题',
    '瀹為檯': '实际',
    '娣诲姞': '添加',
    '鏂板': '新增',
    '鍔熻兘': '功能',
    '姒傝堪': '概述',
    '鏍稿績': '核心',
    '鐗规€?': '特性',
    '鏅鸿兘': '智能',
    '璺緞': '路径',
    '绛涢€?': '筛选',
    '鍙岄噸': '双重',
    '数据': '数据',
    '璐ㄩ噺': '质量',
    '鎺у埗': '控制',
    '缁嗙矑': '细粒',
    '绮掑害': '粒度',
    '涓夊尯': '三区',
    '鍩?': '域',
    '鎷熷悎': '拟合',
    '鑱氱被': '聚类',
    '閫忔槑': '透明',
    '搴?': '度',
    '鑷姩': '自动',
    '生成': '生成',
    '璇︾粏': '详细',
    '绛涢€夋姤': '筛选报',
    '鍛?': '告',
    
    # 数据相关
    '输入': '输入',
    '鏂囦欢': '文件',
    '蹇呴渶': '必需',
    '鍔犺浇': '加载',
    '鑳介噺': '能量',
    '鎬昏兘': '总能',
    '閲?': '量',
    '鍥㈢皣': '团簇',
    '杞戒綋': '载体',
    '鏉ユ簮': '来源',
    '妯℃嫙': '模拟',
    '列?': '列',
    '统计': '统计',
    '褰曘€?': '录',
    '搴旂敤': '应用',
    '鍚?': '后',
    '示例': '示例',
    '鐩綍': '目录',
    '结构': '结构',
    '娓╁害': '温度',
    '鎸囨暟': '指数',
    '鏂规硶': '方法',
    '鑰楁椂': '耗时',
    '鏃堕棿鎴?': '时间戳',
    '鍘熷': '原始',
    '鍚堝苟': '合并',
    '鍘婚噸': '去重',
    '绉婚櫎': '移除',
    '娉ㄦ剰': '注意',
    '鍏抽敭': '关键',
    '鍏冪礌': '元素',
    
    # 算法相关
    '绠楁硶': '算法',
    '鍘熺悊': '原理',
    '鐩告€?': '相态',
    '鍒嗙被': '分类',
    '鍥烘€?': '固态',
    '棰勭啍': '预熔',
    '鍖?': '化',
    '娑叉€?': '液态',
    '闃堝€?': '阈值',
    '娓╁害鍖?': '温度区',
    '闂?': '间',
    '璇嗗埆': '识别',
    '杩炵画': '连续',
    '鑼冨洿': '范围',
    '鏈€灏?': '最小',
    '鐐?': '点',
    '淇濊瘉': '保证',
    '鍙潬': '可靠',
    '鎬?': '性',
    '绾挎€?': '线性',
    '鏂?': '斜',
    '鐜?': '率',
    '璇勪及': '评估',
    '浼樺害': '优度',
    '鏍囧噯': '标准',
    '璇樊': '误差',
    '鍙傛暟': '参数',
    '涓嶇'': '不确',
    '瀹氭€?': '定性',
    
    # 体系相关
    '浣撶郴': '体系',
    '绛栫暐': '策略',
    '绯诲垪': '系列',
    '鍖归厤': '匹配',
    '妯″紡': '模式',
    '鐗圭偣': '特点',
    '鍙傝€?': '参考',
    '鍥哄畾': '固定',
    '鎴愬垎': '成分',
    '鍚噺': '含量',
    
    # 使用说明
    '浣跨敤': '使用',
    '璇存槑': '说明',
    '鍛戒护': '命令',
    '琛?': '行',
    '鍙傛暟': '参数',
    '寮€鍚?': '开启',
    '鍊?': '值',
    '榛樿': '默认',
    '鏇翠弗': '更严',
    '鏍?': '格',
    '鍒欑敤': '则用',
    '澶у€?': '大值',
    '杩愯': '运行',
    '杈撳嚭': '输出',
    '纭': '认',
    '缁堢': '终端',
    '鏄剧ず': '显示',
    '杩涘害': '进度',
    '妫€鏌?': '检查',
    
    # 典型数据
    '鍏稿瀷': '典型',
    '鏈': '未',
    '杩囨护': '过滤',
    '璐ㄩ噺鎻?': '质量提',
    '鍗?': '升',
    '娉ㄦ剰浜?': '注意事',
    '椤?': '项',
    '鐑鍊?': '热容值',
    '鎬绘€?': '总热',
    '闇€鎵?': '需扣',
    '闄?': '除',
    '濡傛棤': '如无',
    '瑙?': '视',
    '涓轰紭': '为优',
    '绉€': '秀',
    '鐩告€佸尯': '相态区',
    '浼氳烦': '会跳',
    '杩?': '过',
    '閫夋嫨': '选择',
    '寤鸿': '建议',
    '閫傜敤': '适用',
    '澶у': '大多',
    '鏁?': '数',
    '鎯呭喌': '情况',
    '鏈€涓?': '最严',
    '鏍?': '格',
    '鐢ㄤ簬': '用于',
    '瀵规瘮': '对比',
    '楠岃瘉': '验证',
    '鏁堟灉': '效果',
    '浠?': '仅',
    '鐙珛': '独立',
    
    # 依赖关系
    '渚濊禆': '依赖',
    '鍏崇郴': '关系',
    '涓婃父': '上游',
    '寮傚父': '异常',
    '涓嬫父': '下游',
    '搴旂敤': '应用',
    '褰卞搷': '影响',
    '鐮旂┒': '研究',
    '鐔斿寲': '熔化',
    '鎴愬': '成分',
    '鍙樺寲': '变化',
    
    # 版本历史
    '鍘嗗彶': '历史',
    '娣诲姞': '添加',
    '璇︾粏': '详细',
    '鏂囨。': '文档',
    '鍖?': '化',
    '鍜?': '和',
    '鍘熺悊': '原理',
    '鍒濆': '初始',
    '鏀?': '支',
    '鎸?': '持',
    
    # 其他
    '鐗圭': '特殊',
    '澶勭悊': '处理',
    '缁熶竴': '统一',
    '鍛藉悕': '命名',
    '閬垮厤': '避免',
    '閲嶅': '重复',
    '琚媶': '被拆',
    '鍒嗭紝': '分',
    '缁ф壙': '继承',
    '瀹屽叏': '完全',
    '涓€鑷?': '一致',
    '鍙': '双',
    '寮傚父鍊肩瓫': '异常值筛',
    '缁勫垎': '组分',
    '棰濆': '额外',
    '鍗?': '单',
    '鐙': '独',
    '涓?': '个',
    '鍥?': '图',
    '琛?': '表',
    '鍛藉悕': '命名',
    '浜?': '个',
    '甯?': '布',
    '灞€': '局',
    '瀛?': '子',
    '鐩?': '相',
    '鑳介噺': '能量',
    '娓╁害': '温度',
    '鏁?': '散',
    '鐐?': '点',
    '鎸?': '按',
    '鐫€鑹?': '着色',
    '绾?': '线',
    '鍚?': '合',
    '鏌辩姸': '柱状',
    '涓?': '三',
    '鏌?': '柱',
    '杞?': '线',
    '鍫?': '堆',
    '鍙?': '叠',
    '鍒?': '分',
    '甯?': '布',
    '鏄剧ず': '显示',
    '姣?': '每',
    
    # 其他高频词
    '鎵€鏈?': '所有',
    '鏁版嵁': '数据',
    '鍐呭': '内容',
    '鍖?': '包',
    '鎻?': '含',
    '鍖?': '匹',
    '閰?': '配',
    '鍖?': '合',
    '骞?': '并',
    '瀵?': '对',
    '姣?': '比',
    '缁?': '综',
    '鎻?': '摘',
    '涓?': '三',
    '鍖?': '区',
    '鎷?': '拟',
    '鍚?': '合',
    '鑼?': '范',
    '鍥?': '围',
    '鍗?': '单',
    '鏋?': '构',
    '琛?': '表',
    '绀?': '示',
    '鍚?': '名',
    '浣?': '体',
    '绯?': '系',
    '涓?': '个',
    '绫?': '类',
    '鍨?': '型',
    '姣?': '比',
    '杈?': '较',
    '鍥?': '固',
    '鎬?': '态',
    '娑?': '液',
    '娓?': '温',
    '甯?': '度',
    '鎬?': '总',
    '缁?': '结',
    '璁?': '论',
    '鏈€': '最',
    '浣?': '佳',
    '鎷?': '拟',
    '鎷?': '拟',
    '瓒?': '超',
    '鍑?': '出',
    '杩?': '远',
    '鍙?': '可',
    '浠?': '以',
    '鍏?': '完',
    '鎴?': '成',
    '鍖?': '化',
    '娑叉€?': '液态',
    '鏈?': '术',
    '椤?': '项',
    '鑴?': '脚',
    '鏈?': '本',
}

def fix_mojibake(text):
    """修复文本中的乱码"""
    for garbled, correct in MOJIBAKE_MAP.items():
        text = text.replace(garbled, correct)
    return text

def main():
    # 文件路径
    script_dir = Path(__file__).parent
    original_file = script_dir / 'step7_4_multi_system_heat_capacity.py'
    backup_file = script_dir / 'step7_4_multi_system_heat_capacity.py.bak'
    fixed_file = script_dir / 'step7_4_multi_system_heat_capacity_fixed.py'
    
    print("="*80)
    print("修复 step7_4_multi_system_heat_capacity.py 文件的中文乱码")
    print("="*80)
    
    # 检查原文件是否存在
    if not original_file.exists():
        print(f"错误: 找不到文件 {original_file}")
        return
    
    print(f"\n1. 读取原文件: {original_file.name}")
    
    # 读取原文件
    try:
        with open(original_file, 'r', encoding='utf-8') as f:
            content = f.read()
        print(f"   ✓ 文件已读取 ({len(content)} 字符)")
    except Exception as e:
        print(f"   ✗ 读取失败: {e}")
        return
    
    # 修复乱码
    print(f"\n2. 修复中文乱码")
    fixed_content = fix_mojibake(content)
    
    # 统计修复数量
    fixes_count = sum(1 for garbled in MOJIBAKE_MAP.keys() if garbled in content)
    print(f"   ✓ 检测到 {fixes_count} 处乱码")
    
    # 保存修复后的文件
    print(f"\n3. 保存修复后的文件: {fixed_file.name}")
    try:
        with open(fixed_file, 'w', encoding='utf-8') as f:
            f.write(fixed_content)
        print(f"   ✓ 文件已保存")
    except Exception as e:
        print(f"   ✗ 保存失败: {e}")
        return
    
    print(f"\n{'='*80}")
    print("修复完成!")
    print(f"{'='*80}")
    print(f"\n原文件: {original_file}")
    print(f"修复后: {fixed_file}")
    print(f"\n请:")
    print(f"  1. 打开 {fixed_file.name} 检查中文是否正确")
    print(f"  2. 如果正确,可以用新文件替换原文件")
    print(f"  3. 替换命令: move /Y {fixed_file.name} {original_file.name}")
    print(f"     (原文件会自动备份为 .bak 文件)")

if __name__ == '__main__':
    main()
